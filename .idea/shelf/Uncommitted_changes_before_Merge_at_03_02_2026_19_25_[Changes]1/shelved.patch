Index: map4aid_project/controllers/service_email/mail_sender.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from abc import ABC, abstractmethod\r\n\r\n\r\nclass MailSender(ABC):\r\n\r\n    @abstractmethod\r\n    def send_otp(self, email: str, codice: int) -> bool:\r\n        pass\r\n\r\n    @abstractmethod\r\n    def send_donazione_monetaria(\r\n        self,\r\n        email_ente: str,\r\n        nome_ente: str,\r\n        email_donatore: str,\r\n        importo: float,\r\n        data\r\n    ) -> bool:\r\n        pass\r\n\r\n    @abstractmethod\r\n    def send_segnalazione(\r\n        self,\r\n        email_ente: str,\r\n        indirizzo: str,\r\n        lat: float,\r\n        lon: float\r\n    ) -> bool:\r\n        pass\r\n\r\n    @abstractmethod\r\n    def send_donazione_bene_ente(\r\n            self,\r\n            email_ente,\r\n            email_donatore,\r\n            bene,\r\n            donazione,\r\n            punto_bisogno,\r\n            sottocategoria,\r\n            indirizzo\r\n    ) -> bool:\r\n        pass\r\n\r\n    @abstractmethod\r\n    def send_donazione_bene_donatore(\r\n            self,\r\n            email_donatore,\r\n            email_ente,\r\n            bene\r\n    ) -> bool:\r\n        pass
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/map4aid_project/controllers/service_email/mail_sender.py b/map4aid_project/controllers/service_email/mail_sender.py
--- a/map4aid_project/controllers/service_email/mail_sender.py	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ b/map4aid_project/controllers/service_email/mail_sender.py	(date 1770141319304)
@@ -48,4 +48,29 @@
             email_ente,
             bene
     ) -> bool:
+        pass
+
+    @abstractmethod
+    def send_prenotazione_beneficiario(
+            self,
+            email_ente: str,
+            email_beneficiario: str,
+            indirizzo: str,
+            lat: float,
+            lon: float,
+            prenotazione_id: int,
+            nome_bene: str | None = None
+    ) -> bool:
+        pass
+
+    @abstractmethod
+    def send_prenotazione_ente(
+            self,
+            email_ente: str,
+            email_beneficiario: str,
+            indirizzo: str,
+            lat: float,
+            lon: float,
+            nome_bene: str | None = None
+    ) -> bool:
         pass
\ No newline at end of file
Index: map4aid_project/controllers/login_control.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import secrets\r\n\r\nfrom flask_login import logout_user, current_user\r\n\r\nfrom config import db\r\nfrom flask import request, session, jsonify\r\nfrom controllers.service_email.EmailControl import EmailControl\r\nfrom models.models import Account\r\nfrom models.pendingAccounts import PendingAccount\r\nfrom controllers.routes import auth_bp\r\nfrom controllers.service_email.email_control_bridge import EmailControlBridge\r\nfrom controllers.auth_service.auth_facade import AuthFacade\r\n\r\n@auth_bp.route(\"/login\", methods=[\"POST\"])\r\ndef login():\r\n\r\n    if current_user.is_authenticated:\r\n        return jsonify({\"error\": \"Già loggato\"}), 400\r\n\r\n    facade = AuthFacade(EmailControlBridge())\r\n\r\n    try:\r\n        facade.login_with_otp(\r\n            request.form.get(\"email\"),\r\n            request.form.get(\"password\")\r\n        )\r\n        return jsonify({\"message\": \"Email inviata\"}), 200\r\n\r\n    except ValueError as e:\r\n        return jsonify({\"error\": str(e)}), 401\r\n\r\n    except RuntimeError as e:\r\n        return jsonify({\"error\": str(e)}), 500\r\n\r\n\r\n@auth_bp.route(\"/logout\", methods=[\"POST\"])\r\ndef logout():\r\n    session.clear()\r\n    logout_user()\r\n    return jsonify({\"message\": \"Logout effettuato\"})\r\n\r\n@auth_bp.route(\"/recuperoPassword\", methods=[\"POST\"])\r\ndef recupero_password():\r\n    email = request.form.get(\"email\")\r\n    if not email:\r\n        return jsonify({\"error\": \"Email mancante\"}), 400\r\n\r\n    # Genera codice OTP sicuro a 4 cifre\r\n    codice = secrets.randbelow(9000) + 1000  # tra 1000 e 9999\r\n\r\n    # Salva nella sessione email\r\n    session[\"pending_email\"] = email\r\n    puser = PendingAccount(\r\n        email = email,\r\n        token = codice\r\n    )\r\n    db.session.add(puser)\r\n    db.session.commit()\r\n\r\n    # Invia email con il codice\r\n    email_control = EmailControl()\r\n    email_ok = email_control.invia_email_codice(email, codice)\r\n\r\n    if not email_ok:\r\n        return jsonify({\"message\": \"Email di recupero inviata\"}), 200\r\n\r\n    return jsonify({\"errore\": \"Email di recupero non inviata\"}), 200\r\n\r\n\r\n@auth_bp.route(\"/confermaRecupero\", methods=[\"POST\"])\r\ndef conferma_recupero():\r\n    email = session.get(\"pending_email\")\r\n    puser = PendingAccount.query.filter_by(email=email).first()\r\n    if not puser:\r\n        return jsonify({\"error\": \"Nessuna richiesta in corso\"}), 400\r\n\r\n    codice_inserito = request.form.get(\"codice\")\r\n    if codice_inserito != puser.token:\r\n        return jsonify({\"error\": \"Codice non valido\"}), 401\r\n\r\n    # Codice corretto → consenti cambio password\r\n    session[\"reset_verified\"] = email  # salva email verificata\r\n    session.pop(\"pending_email\")  # rimuovi codice\r\n\r\n    return jsonify({\"message\": \"Codice valido, puoi cambiare la password\"}), 200\r\n\r\n\r\n@auth_bp.route(\"/cambiaPassword\", methods=[\"POST\"])\r\ndef cambia_password():\r\n    email = session.get(\"reset_verified\")\r\n    if not email:\r\n        return jsonify({\"error\": \"Nessuna email verificata\"}), 400\r\n\r\n    nuova_password = request.form.get(\"nuova_password\")\r\n    if not nuova_password:\r\n        return jsonify({\"error\": \"Password mancante\"}), 400\r\n\r\n    user = Account.query.filter_by(email=email).first()\r\n    if not user:\r\n        return jsonify({\"error\": \"Utente non trovato\"}), 404\r\n\r\n    user.set_password(nuova_password)\r\n    db.session.commit()\r\n\r\n    session.pop(\"reset_verified\")  # pulizia sessione\r\n    return jsonify({\"message\": \"Password cambiata con successo\"}), 200
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/map4aid_project/controllers/login_control.py b/map4aid_project/controllers/login_control.py
--- a/map4aid_project/controllers/login_control.py	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ b/map4aid_project/controllers/login_control.py	(date 1770139865449)
@@ -9,7 +9,7 @@
 from models.pendingAccounts import PendingAccount
 from controllers.routes import auth_bp
 from controllers.service_email.email_control_bridge import EmailControlBridge
-from controllers.auth_service.auth_facade import AuthFacade
+from controllers.auth_facade import AuthFacade
 
 @auth_bp.route("/login", methods=["POST"])
 def login():
Index: map4aid_project/controllers/service_email/EmailControl.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import smtplib\r\nfrom email.mime.text import MIMEText\r\nfrom email.mime.multipart import MIMEMultipart\r\n\r\n\r\nclass EmailControl:\r\n\r\n\r\n    def __init__(self):\r\n        self.config = {\r\n            \"smtp_server\": \"smtp.gmail.com\",\r\n            \"smtp_port\": 587,\r\n            \"email\": \"map4aid01@gmail.com\",\r\n            \"password\": \"cmtf ymqz iekk lqbq\"\r\n        }\r\n\r\n    def invia_email_donazione(self, email_ente, nome_ente,\r\n                              email_donatore, importo, data):\r\n        msg = MIMEMultipart()\r\n        msg[\"From\"] = self.config[\"email\"]\r\n        msg[\"To\"] = email_ente\r\n        msg[\"Subject\"] = \"Notifica di donazione monetaria ricevuta\"\r\n\r\n        corpo = f\"\"\"\r\nGentile {nome_ente},\r\n\r\nla informiamo che in data {data.strftime('%d/%m/%Y %H:%M')}\r\nè stata ricevuta una donazione monetaria tramite la piattaforma.\r\n\r\nDettagli della donazione:\r\n- Importo: € {importo:.2f}\r\n- Donatore: {email_donatore}\r\n\r\nCordiali saluti,\r\nMap4Aid\r\n\"\"\"\r\n\r\n        msg.attach(MIMEText(corpo, \"plain\", \"utf-8\"))\r\n\r\n        try:\r\n            with smtplib.SMTP(self.config[\"smtp_server\"],\r\n                              self.config[\"smtp_port\"]) as server:\r\n                server.starttls()\r\n                server.login(\r\n                    self.config[\"email\"],\r\n                    self.config[\"password\"]\r\n                )\r\n                server.send_message(msg)\r\n            return True\r\n\r\n        except Exception as e:\r\n            print(f\"Errore SMTP: {e}\")\r\n            return False\r\n\r\n    def invia_email_codice(self, email_utente,codice):\r\n        msg = MIMEMultipart()\r\n        msg[\"From\"] = self.config[\"email\"]\r\n        msg[\"To\"] = email_utente\r\n        msg[\"Subject\"] = \"Email per conferma codice\"\r\n\r\n        corpo = f\"\"\"\r\nPer favore inserire il seguente codice per confermare l'emaill:\r\n{codice}\r\nIl codice scadrà dopo 10 minuti\r\n<<<<<<< HEAD\r\n=======\r\nSe hai ricevuto questa email senza aver provato a registrarti probabilmente un utente ha inseirito la tua mail per sbaglio\r\n>>>>>>> controller\r\n        \r\nCordiali saluti,\r\nMap4Aid\"\"\"\r\n\r\n        msg.attach(MIMEText(corpo, \"plain\", \"utf-8\"))\r\n\r\n        try:\r\n            with smtplib.SMTP(self.config[\"smtp_server\"],\r\n                              self.config[\"smtp_port\"]) as server:\r\n                server.starttls()\r\n                server.login(\r\n                    self.config[\"email\"],\r\n                    self.config[\"password\"]\r\n                )\r\n                server.send_message(msg)\r\n            return True\r\n\r\n        except Exception as e:\r\n            print(f\"Errore SMTP: {e}\")\r\n            return False\r\n\r\n    def invia_email_segnalazione(self,email_ente,indirizzo,lan,lon):\r\n        msg = MIMEMultipart()\r\n        msg[\"From\"] = self.config[\"email\"]\r\n        msg[\"To\"] = email_ente\r\n        msg[\"Subject\"] = \"Email per segnalazione punto di bisogno\"\r\n\r\n        corpo = f\"\"\"\r\nE' arrivata una segnalazione per un punto di bisogno.\r\nL'indirizzo è {indirizzo}\r\nLatitudine: {lan}\r\nLongitudine: {lon}\r\nCordiali saluti,\r\nMap4Aid\r\n\"\"\"\r\n\r\n        msg.attach(MIMEText(corpo, \"plain\", \"utf-8\"))\r\n\r\n        try:\r\n            with smtplib.SMTP(self.config[\"smtp_server\"],\r\n                              self.config[\"smtp_port\"]) as server:\r\n                server.starttls()\r\n                server.login(\r\n                    self.config[\"email\"],\r\n                    self.config[\"password\"]\r\n                )\r\n                server.send_message(msg)\r\n            return True\r\n\r\n        except Exception as e:\r\n            print(f\"Errore SMTP: {e}\")\r\n            return False\r\n\r\n    def invia_email_donazione_ente(self, email_ente, email_donatore,bene,donazione,punto_bisogno,sottocategoria,indirizzo):\r\n        msg = MIMEMultipart()\r\n        msg[\"From\"] = self.config[\"email\"]\r\n        msg[\"To\"] = email_ente\r\n        msg[\"Subject\"] = \"Email per conferma donazione bene\"\r\n\r\n        corpo = f\"\"\"\r\nE' stata effetuata una donazione da parte di {email_donatore} in data {donazione.data.day}-{donazione.data.month}-{donazione.data.year} presso un vostro punto di bisogno.\r\nLa invitiamo a contattare il donatore per confermare la donazione.\r\nIl punto di bisogno a cui hanno donato è {punto_bisogno.nome} con indirizzo {indirizzo}\r\nDi seguito sono riportate le informazioni del bene donato:\r\nnome: {bene.nome}\r\nquantita: {bene.quantita}\r\ntipo: {bene.tipo}\r\nsottocategoria: {sottocategoria}\r\n\"\"\"\r\n        if bene.tipo == \"alimentare\":\r\n            extra_data = f\"\"\"\r\nscadenza: {bene.scadenza}\r\nallergeni: {bene.allergeni}\r\n\"\"\"\r\n            corpo += extra_data\r\n\r\n        # Bene per l'igiene\r\n        elif bene.tipo == \"igiene\":\r\n            extra_data = f\"\"\"\r\ndestinatari: {bene.destinatari}\r\n\"\"\"\r\n            corpo += extra_data\r\n\r\n        # Medicinale\r\n        elif bene.tipo == \"medicinale\":\r\n            extra_data = f\"\"\"\r\ntipo medicinale: {bene.tipo_medicinale}\r\nscadenza: {bene.scadenza}\r\n\"\"\"\r\n            corpo += extra_data\r\n\r\n\r\n        # Beni per la mobilità\r\n        elif bene.tipo == \"mobilità\":\r\n            extra_data = f\"\"\"\r\ntipo mobilita: {bene.tipo_mobilita}\r\nstato: {bene.stato}\r\n\"\"\"\r\n            corpo += extra_data\r\n\r\n        # Vestiti\r\n        elif bene.tipo == \"vestiario\":\r\n            extra_data = f\"\"\"\r\ntaglia: {bene.taglia}\r\ncondizioni: {bene.condizioni}\r\n\"\"\"\r\n            corpo += extra_data\r\n\r\n        saluti = f\"\"\"\r\nCordiali saluti,\r\nMap4Aid\"\"\"\r\n        corpo += saluti\r\n        msg.attach(MIMEText(corpo, \"plain\", \"utf-8\"))\r\n\r\n        try:\r\n            with smtplib.SMTP(self.config[\"smtp_server\"],\r\n                              self.config[\"smtp_port\"]) as server:\r\n                server.starttls()\r\n                server.login(\r\n                    self.config[\"email\"],\r\n                    self.config[\"password\"]\r\n                )\r\n                server.send_message(msg)\r\n            return True\r\n\r\n        except Exception as e:\r\n            print(f\"Errore SMTP: {e}\")\r\n            return False\r\n\r\n    def invia_email_donazione_donatore(self,email_donatore,email_ente,bene):\r\n        msg = MIMEMultipart()\r\n        msg[\"From\"] = self.config[\"email\"]\r\n        msg[\"To\"] = email_donatore\r\n        msg[\"Subject\"] = \"Email per conferma donazione bene\"\r\n\r\n        corpo = f\"\"\"\r\nLa donazione di {bene.nome} è andata a buon fine.\r\nSi aspetti un'email o contatti direttamente {email_donatore}.\r\nCordiali saluti,\r\nMap4Aid\r\n\"\"\"\r\n\r\n        msg.attach(MIMEText(corpo, \"plain\", \"utf-8\"))\r\n\r\n        try:\r\n            with smtplib.SMTP(self.config[\"smtp_server\"],\r\n                              self.config[\"smtp_port\"]) as server:\r\n                server.starttls()\r\n                server.login(\r\n                    self.config[\"email\"],\r\n                    self.config[\"password\"]\r\n                )\r\n                server.send_message(msg)\r\n            return True\r\n\r\n        except Exception as e:\r\n            print(f\"Errore SMTP: {e}\")\r\n            return False\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/map4aid_project/controllers/service_email/EmailControl.py b/map4aid_project/controllers/service_email/EmailControl.py
--- a/map4aid_project/controllers/service_email/EmailControl.py	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ b/map4aid_project/controllers/service_email/EmailControl.py	(date 1770141137624)
@@ -1,6 +1,11 @@
 import smtplib
+from email.mime.image import MIMEImage
 from email.mime.text import MIMEText
 from email.mime.multipart import MIMEMultipart
+from io import BytesIO
+
+import qrcode
+from flask import request
 
 
 class EmailControl:
@@ -224,3 +229,103 @@
         except Exception as e:
             print(f"Errore SMTP: {e}")
             return False
+
+    def invia_email_prenotazione_beneficiario(self,email_ente,email_beneficiario,indirizzo,lan,lon,prenotazione_id,nome_bene=None):
+        msg = MIMEMultipart()
+        msg["From"] = self.config["email"]
+        msg["To"] = email_beneficiario
+        msg["Subject"] = "Email per conferma prenotazione"
+
+        #Creazione qrCode
+        buffer = BytesIO()
+        url = f"""{request.url_root}auth/conferma_prenotazione?prenotazione_id={prenotazione_id}"""
+        qr = qrcode.make(url)
+        qr.save(buffer, format="PNG")
+        buffer.seek(0)
+
+        if nome_bene == None:
+            corpo = f"""
+E' stata confermata una prenotazione per un pacco alimentare presso il seguente punto di bisogno posseduto da {email_ente}.
+L'indirizzo è {indirizzo}
+Latitudine: {lan}
+Longitudine: {lon}
+La preghiamo di ritirare il pacco il prima possibile
+
+Cordiali saluti,
+Map4Aid
+"""
+        else:
+            corpo = f"""
+E' stata confermata una prenotazione per il seguente bene:{nome_bene} presso il seguente punto di bisogno posseduto da {email_ente}.
+L'indirizzo è {indirizzo}
+Latitudine: {lan}
+Longitudine: {lon}
+La preghiamo di ritirare il bene il prima possibile
+
+Mostrare il qrCode al punto di bisogno per confermare la prenotazione
+
+Cordiali saluti,
+Map4Aid"""
+
+        msg.attach(MIMEText(corpo, "plain", "utf-8"))
+        img = MIMEImage(buffer.read())
+        img.add_header("Content-ID", "<qrcode>")
+        msg.attach(img)
+
+        try:
+            with smtplib.SMTP(self.config["smtp_server"],
+                              self.config["smtp_port"]) as server:
+                server.starttls()
+                server.login(
+                    self.config["email"],
+                    self.config["password"]
+                )
+                server.send_message(msg)
+            return True
+
+        except Exception as e:
+            print(f"Errore SMTP: {e}")
+            return False
+
+    def invia_email_prenotazione_ente(self,email_ente,email_beneficiario,indirizzo,lan,lon,nome_bene=None):
+        msg = MIMEMultipart()
+        msg["From"] = self.config["email"]
+        msg["To"] = email_ente
+        msg["Subject"] = "Email per conferma prenotazione"
+
+        if nome_bene == None:
+            corpo = f"""
+E' stata confermata una prenotazione per un pacco alimentare presso il seguente punto di bisogno in vostro posseso da parte di {email_beneficiario}.
+L'indirizzo è {indirizzo}
+Latitudine: {lan}
+Longitudine: {lon}
+
+Cordiali saluti,
+Map4Aid
+"""
+        else:
+            corpo = f"""
+E' stata confermata una prenotazione per il seguente bene:{nome_bene} presso il seguente punto di bisogno in vostro posseso da parte di {email_beneficiario}.
+L'indirizzo è {indirizzo}
+Latitudine: {lan}
+Longitudine: {lon}
+
+Cordiali saluti,
+Map4Aid"""
+
+        msg.attach(MIMEText(corpo, "plain", "utf-8"))
+
+        try:
+            with smtplib.SMTP(self.config["smtp_server"],
+                              self.config["smtp_port"]) as server:
+                server.starttls()
+                server.login(
+                    self.config["email"],
+                    self.config["password"]
+                )
+                server.send_message(msg)
+            return True
+
+        except Exception as e:
+            print(f"Errore SMTP: {e}")
+            return False
\ No newline at end of file
Index: map4aid_project/controllers/service_email/email_control_bridge.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from controllers.service_email.mail_sender import MailSender\r\nfrom controllers.service_email.EmailControl import EmailControl\r\n\r\n\r\nclass EmailControlBridge(MailSender):\r\n\r\n    def __init__(self):\r\n        self._email_control = EmailControl()\r\n\r\n    def send_otp(self, email: str, codice: int) -> bool:\r\n        return self._email_control.invia_email_codice(email, codice)\r\n\r\n    def send_donazione_monetaria(\r\n        self,\r\n        email_ente,\r\n        nome_ente,\r\n        email_donatore,\r\n        importo,\r\n        data\r\n    ) -> bool:\r\n        return self._email_control.invia_email_donazione(\r\n            email_ente,\r\n            nome_ente,\r\n            email_donatore,\r\n            importo,\r\n            data\r\n        )\r\n\r\n    def send_segnalazione(\r\n        self,\r\n        email_ente,\r\n        indirizzo,\r\n        lat,\r\n        lon\r\n    ) -> bool:\r\n        return self._email_control.invia_email_segnalazione(\r\n            email_ente,\r\n            indirizzo,\r\n            lat,\r\n            lon\r\n        )\r\n\r\n    def send_donazione_bene_ente(\r\n            self,\r\n            email_ente,\r\n            email_donatore,\r\n            bene,\r\n            donazione,\r\n            punto_bisogno,\r\n            sottocategoria,\r\n            indirizzo\r\n    ) -> bool:\r\n        return self._email_control.invia_email_donazione_ente(\r\n            email_ente,\r\n            email_donatore,\r\n            bene,\r\n            donazione,\r\n            punto_bisogno,\r\n            sottocategoria,\r\n            indirizzo\r\n        )\r\n\r\n    def send_donazione_bene_donatore(\r\n            self,\r\n            email_donatore,\r\n            email_ente,\r\n            bene\r\n    ) -> bool:\r\n        return self._email_control.invia_email_donazione_donatore(\r\n            email_donatore,\r\n            email_ente,\r\n            bene\r\n        )
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/map4aid_project/controllers/service_email/email_control_bridge.py b/map4aid_project/controllers/service_email/email_control_bridge.py
--- a/map4aid_project/controllers/service_email/email_control_bridge.py	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ b/map4aid_project/controllers/service_email/email_control_bridge.py	(date 1770141282975)
@@ -70,4 +70,42 @@
             email_donatore,
             email_ente,
             bene
-        )
\ No newline at end of file
+        )
+
+    def send_prenotazione_beneficiario(
+            self,
+            email_ente,
+            email_beneficiario,
+            indirizzo,
+            lat,
+            lon,
+            prenotazione_id,
+            nome_bene=None
+    ) -> bool:
+        return self._email_control.invia_email_prenotazione_beneficiario(
+            email_ente,
+            email_beneficiario,
+            indirizzo,
+            lat,
+            lon,
+            prenotazione_id,
+            nome_bene
+        )
+
+    def send_prenotazione_ente(
+            self,
+            email_ente,
+            email_beneficiario,
+            indirizzo,
+            lat,
+            lon,
+            nome_bene=None
+    ) -> bool:
+        return self._email_control.invia_email_prenotazione_ente(
+            email_ente,
+            email_beneficiario,
+            indirizzo,
+            lat,
+            lon,
+            nome_bene
+        )
Index: map4aid_project/controllers/donazione_monetaria_control.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from datetime import timezone, datetime\r\n\r\nfrom flask import request, session\r\nfrom controllers.routes import auth_bp\r\nfrom controllers.service_email.email_control_bridge import EmailControlAdapter\r\nfrom models import AccountEnteErogatore\r\nfrom controllers.permessi import require_roles\r\nfrom config import db\r\nfrom models.models import AccountDonatore, DonazioneMonetaria\r\n\r\n\r\n@auth_bp.route(\"/donazioneMonetaria\", methods=[\"POST\"])\r\n@require_roles(\"donatore\",\"beneficiario\",\"ente_erogatore\")\r\ndef donazione_monetaria():\r\n        # ---- DATI DA SESSIONE ----\r\n    email_donatore = session.get(\"user_email\")\r\n\r\n    # ---- DATI DA FORM ----\r\n    nome_ente = request.form.get(\"nome_ente_erogatore\")\r\n    numero_carta = request.form.get(\"numero_carta\")\r\n    scadenza_str = request.form.get(\"scadenza\")\r\n    scadenza = datetime.strptime(scadenza_str, \"%Y-%m-%d\").date()\r\n    cvv = request.form.get(\"cvv\")\r\n    mail_sender = EmailControlAdapter()\r\n\r\n    importo = 0\r\n    try:\r\n        importo = float(request.form.get(\"importo\"))\r\n    except (TypeError, ValueError):\r\n        return {\"errore\": \"Importo non valido\"},400\r\n\r\n    ente_erogatore = AccountEnteErogatore.query.filter_by(nome_organizzazione=nome_ente).first()\r\n    ente_donatore = AccountDonatore.query.filter_by(email=email_donatore).first()\r\n    email_ente = ente_erogatore.email\r\n    iban_ente = ente_erogatore.iban\r\n\r\n    # ---- VALIDAZIONE ----\r\n    if not all([email_ente, iban_ente, numero_carta, scadenza, cvv]):\r\n        return {\"errore\": \"Dati obbligatori mancanti\"},400\r\n\r\n    if importo <= 0:\r\n        return {\"errore\": \"Importo non valido\"},400\r\n\r\n    # ---- TRANSAZIONE MONETARIA ----\r\n    transazione_ok = esegui_transazione(\r\n        numero_carta, scadenza, cvv, iban_ente, importo\r\n    )\r\n\r\n    if not transazione_ok:\r\n        return {\"successo\": False, \"errore\": \"Transazione rifiutata\"},400\r\n\r\n    # ---- CREAZIONE ENTITY ----\r\n    donazione = DonazioneMonetaria(\r\n        donatore_id=ente_donatore.id,\r\n        ente_id=ente_erogatore.id,\r\n        importo=importo,\r\n        data =  datetime.now(timezone.utc)\r\n    )\r\n\r\n    db.session.add(donazione)\r\n    db.session.commit()\r\n\r\n    # ---- EMAIL DI CONFERMA ----\r\n    email_ok = mail_sender.send_donazione_monetaria(\r\n        email_ente=email_ente,\r\n        nome_ente=nome_ente,\r\n        email_donatore=email_donatore,\r\n        importo=importo,\r\n        data=donazione.data\r\n    )\r\n\r\n    if not email_ok:\r\n        return {\r\n            \"errore\": \"Donazione eseguita ma email non inviata\"\r\n        },400\r\n\r\n    return {\r\n        \"messaggio\": \"Donazione monetaria completata con successo\"\r\n    },200\r\n\r\n\r\ndef esegui_transazione(numero_carta, scadenza, cvv,\r\n                        iban_destinatario, importo):\r\n    print(\"transazione in elaborazione\")\r\n    if len(numero_carta) != 16:\r\n        return False\r\n    if len(cvv) != 3:\r\n        return False\r\n    if not iban_destinatario.startswith(\"IT\"):\r\n        return False\r\n    if scadenza < datetime.now(timezone.utc):\r\n        return False\r\n    return True\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/map4aid_project/controllers/donazione_monetaria_control.py b/map4aid_project/controllers/donazione_monetaria_control.py
--- a/map4aid_project/controllers/donazione_monetaria_control.py	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ b/map4aid_project/controllers/donazione_monetaria_control.py	(date 1770139513538)
@@ -2,7 +2,7 @@
 
 from flask import request, session
 from controllers.routes import auth_bp
-from controllers.service_email.email_control_bridge import EmailControlAdapter
+from controllers.service_email.email_control_bridge import EmailControlBridge
 from models import AccountEnteErogatore
 from controllers.permessi import require_roles
 from config import db
@@ -21,7 +21,7 @@
     scadenza_str = request.form.get("scadenza")
     scadenza = datetime.strptime(scadenza_str, "%Y-%m-%d").date()
     cvv = request.form.get("cvv")
-    mail_sender = EmailControlAdapter()
+    mail_sender = EmailControlBridge()
 
     importo = 0
     try:
Index: map4aid_project/controllers/donazione_bene.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from datetime import timezone, datetime\r\n\r\nfrom geopy.geocoders import Nominatim\r\nfrom flask import request, session\r\nfrom controllers.routes import auth_bp\r\nfrom controllers.service_email.email_control_bridge import EmailControlAdapter\r\nfrom models import AccountEnteErogatore\r\nfrom controllers.service_email.EmailControl import EmailControl\r\nfrom controllers.permessi import require_roles\r\nfrom config import db\r\nfrom models.models import AccountDonatore, PuntoDistribuzione, BeneAlimentare, SottoCategoria, \\\r\n    BeneIgiene, BeneMobilita, DonazioneBene\r\n\r\n\r\n@auth_bp.route(\"/donazioneBene\", methods=[\"POST\"])\r\n@require_roles(\"donatore\")\r\ndef donazioneBene():\r\n    mail_sender = EmailControlAdapter()\r\n    geolocator = Nominatim(user_agent=\"map4aid_project\")#per convertire latitudine e longitudine in indirizzo\r\n    email_donatore = session.get(\"user_email\")\r\n    nome = request.form.get(\"nome\")\r\n    quantita = request.form.get(\"quantita\")\r\n    tipo = request.form.get(\"tipo\")\r\n    punto_nome = request.form.get(\"punto_distribuzione_nome\")\r\n    sottocategoria_nome = request.form.get(\"sottocategoria\")\r\n\r\n    if not all([nome,quantita,tipo,punto_nome]):\r\n        return {\"Errore\",\"Campi obbligatori mancanti\"},400\r\n\r\n    punto_distribuzione = PuntoDistribuzione.query.filter_by(nome=punto_nome).first()\r\n    location = geolocator.reverse((punto_distribuzione.latitudine,punto_distribuzione.longitudine))\r\n    sottocategoria = SottoCategoria.query.filter_by(nome=sottocategoria_nome).first()\r\n    donatore = AccountDonatore.query.filter_by(email=email_donatore).first()\r\n    erogatore = AccountEnteErogatore.query.filter_by(id=punto_distribuzione.ente_erogatore_id).first()\r\n\r\n    #Bene alimentare\r\n    if tipo == \"alimentare\":\r\n        bene = BeneAlimentare(\r\n            nome = nome,\r\n            quantita = quantita,\r\n            punto_distribuzione_id = punto_distribuzione.id,\r\n            sottocategoria_id = sottocategoria.id,\r\n            allergeni=request.form.get(\"allergeni\"),\r\n            scadenza = datetime.strptime(request.form.get(\"scadenza\"), \"%Y-%m-%d\").date()\r\n        )\r\n\r\n    #Bene per l'igiene\r\n    elif tipo == \"igiene\":\r\n        bene = BeneIgiene(\r\n            nome=nome,\r\n            quantita=quantita,\r\n            punto_distribuzione_id=punto_distribuzione.id,\r\n            sottocategoria_id=sottocategoria.id,\r\n            destinatari = request.form.get(\"destinatari\")\r\n        )\r\n\r\n\r\n    #Medicinale\r\n    elif tipo == \"medicinale\":\r\n        bene = BeneIgiene(\r\n            nome=nome,\r\n            quantita=quantita,\r\n            punto_distribuzione_id=punto_distribuzione.id,\r\n            sottocategoria_id=sottocategoria.id,\r\n            tipo_medicinale=request.form.get(\"tipo_medicinale\"),\r\n            scadenza = datetime.strptime(request.form.get(\"scadenza\"), \"%Y-%m-%d\").date()\r\n        )\r\n\r\n\r\n    #Beni per la mobilità\r\n    elif tipo == \"mobilità\":\r\n        bene = BeneMobilita(\r\n            nome=nome,\r\n            quantita=quantita,\r\n            punto_distribuzione_id=punto_distribuzione.id,\r\n            sottocategoria_id=sottocategoria.id,\r\n            tipo_mobilita=request.form.get(\"tipo_mobilita\"),\r\n            stato = request.form.get(\"stato\"),\r\n        )\r\n\r\n    #Vestiti\r\n    elif tipo == \"vestiario\":\r\n        bene = BeneMobilita(\r\n            nome=nome,\r\n            quantita=quantita,\r\n            punto_distribuzione_id=punto_distribuzione.id,\r\n            sottocategoria_id=sottocategoria.id,\r\n            taglia=request.form.get(\"taglia\"),\r\n            condizioni = request.form.get(\"condizioni\")\r\n        )\r\n\r\n    db.session.add(bene)\r\n    db.session.commit()\r\n\r\n    donazione = DonazioneBene(\r\n        donatore_id = donatore.id,\r\n        ente_erogatore_id = punto_distribuzione.ente_erogatore_id,\r\n        bene_id = bene.id,\r\n        punto_id = punto_distribuzione.id,\r\n        data = datetime.now(timezone.utc)\r\n    )\r\n    db.session.add(donazione)\r\n    db.session.commit()\r\n    email_control = EmailControl()\r\n    email_ok1 = mail_sender.send_donazione_bene_ente(erogatore.email,donatore.email,bene,donazione,punto_distribuzione,sottocategoria_nome,location.address)\r\n    email_ok2 = mail_sender.send_donazione_bene_donatore(donatore.email,erogatore.email,bene)\r\n\r\n    if email_ok1 and email_ok2:\r\n        return {\"message\":\"Donazione di bene effetuata\"},200\r\n    else:\r\n        return {\"errore\":\"Donazione effetuata ma email non inviate\"},500\r\n\r\n\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/map4aid_project/controllers/donazione_bene.py b/map4aid_project/controllers/donazione_bene.py
--- a/map4aid_project/controllers/donazione_bene.py	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ b/map4aid_project/controllers/donazione_bene.py	(date 1770139513545)
@@ -3,7 +3,7 @@
 from geopy.geocoders import Nominatim
 from flask import request, session
 from controllers.routes import auth_bp
-from controllers.service_email.email_control_bridge import EmailControlAdapter
+from controllers.service_email.email_control_bridge import EmailControlBridge
 from models import AccountEnteErogatore
 from controllers.service_email.EmailControl import EmailControl
 from controllers.permessi import require_roles
@@ -15,7 +15,7 @@
 @auth_bp.route("/donazioneBene", methods=["POST"])
 @require_roles("donatore")
 def donazioneBene():
-    mail_sender = EmailControlAdapter()
+    mail_sender = EmailControlBridge()
     geolocator = Nominatim(user_agent="map4aid_project")#per convertire latitudine e longitudine in indirizzo
     email_donatore = session.get("user_email")
     nome = request.form.get("nome")
Index: map4aid_project/controllers/segnalazione_control.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from flask import request\r\n\r\nfrom controllers.permessi import require_roles\r\nfrom controllers.routes import auth_bp\r\nfrom controllers.service_email.EmailControl import EmailControl\r\nfrom controllers.service_email.email_control_bridge import EmailControlAdapter\r\nfrom models.models import AccountEnteErogatore\r\n\r\n@auth_bp.route(\"/segnalazione\", methods=[\"POST\"])\r\n@require_roles(\"donatore\",\"beneficiario\",\"ente_erogatore\")\r\ndef segnalazione():\r\n    data = request.get_json()\r\n    lat = data[\"latitudine\"]\r\n    lon = data[\"longitudine\"]\r\n    indirizzo = data[\"indirizzo\"]\r\n    mail_sender = EmailControlAdapter()\r\n    resoconto = {\r\n        \"successo\": True,\r\n        \"email_non_inviate\": []\r\n    }\r\n    enti_erogatori = AccountEnteErogatore.query.all()\r\n    for ente in enti_erogatori:\r\n        email_ok = mail_sender.send_segnalazione(\r\n            email_ente=ente.email,\r\n            indirizzo=indirizzo,\r\n            lat=lat,\r\n            lon=lon\r\n        )\r\n        if not email_ok:\r\n            resoconto[\"successo\"] = False\r\n            resoconto[\"email_non_inviate\"].append(ente.email)\r\n\r\n\r\n\r\n    if resoconto[\"successo\"]:\r\n        return {\r\n            \"successo\": True,\r\n            \"messaggio\": \"Segnalazione completata con successo\"\r\n        }\r\n    else:\r\n        return {\r\n            \"successo\": False,\r\n            \"messaggio\": \"Segnalazione non avvenuta con successo\",\r\n            \"email_non_inviate\": resoconto[\"email_non_inviate\"]\r\n        }\r\n\r\n\r\n\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/map4aid_project/controllers/segnalazione_control.py b/map4aid_project/controllers/segnalazione_control.py
--- a/map4aid_project/controllers/segnalazione_control.py	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ b/map4aid_project/controllers/segnalazione_control.py	(date 1770136794842)
@@ -3,7 +3,7 @@
 from controllers.permessi import require_roles
 from controllers.routes import auth_bp
 from controllers.service_email.EmailControl import EmailControl
-from controllers.service_email.email_control_bridge import EmailControlAdapter
+from controllers.service_email.email_control_bridge import EmailControlBridge
 from models.models import AccountEnteErogatore
 
 @auth_bp.route("/segnalazione", methods=["POST"])
@@ -13,7 +13,7 @@
     lat = data["latitudine"]
     lon = data["longitudine"]
     indirizzo = data["indirizzo"]
-    mail_sender = EmailControlAdapter()
+    mail_sender = EmailControlBridge()
     resoconto = {
         "successo": True,
         "email_non_inviate": []
Index: .idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13__Changes_.xml
===================================================================
diff --git a/.idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13__Changes_.xml b/.idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13__Changes_.xml
deleted file mode 100644
--- a/.idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13__Changes_.xml	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ /dev/null	(revision 489e417a4cc032d1174685030d2215fd52baf392)
@@ -1,9 +0,0 @@
-<changelist name="Uncommitted_changes_before_Merge_at_25_01_2026_01_13_[Changes]" date="1769300037314" recycled="true" deleted="true">
-  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13_[Changes]/shelved.patch" />
-  <option name="DESCRIPTION" value="Uncommitted changes before Merge at 25/01/2026 01:13 [Changes]" />
-  <binary>
-    <option name="BEFORE_PATH" value="map4aid_project/instance/database.db" />
-    <option name="AFTER_PATH" value="map4aid_project/instance/database.db" />
-    <option name="SHELVED_PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13_[Changes]/database.db" />
-  </binary>
-</changelist>
\ No newline at end of file
Index: .idea/shelf/Uncommitted_changes_before_rebase_[Changes]/shelved.patch
===================================================================
diff --git a/.idea/shelf/Uncommitted_changes_before_rebase_[Changes]/shelved.patch b/.idea/shelf/Uncommitted_changes_before_rebase_[Changes]/shelved.patch
deleted file mode 100644
--- a/.idea/shelf/Uncommitted_changes_before_rebase_[Changes]/shelved.patch	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ /dev/null	(revision 489e417a4cc032d1174685030d2215fd52baf392)
@@ -1,19 +0,0 @@
-Index: .idea/workspace.xml
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"55397952-be6e-4a64-8a4f-522745ebe921\" name=\"Changes\" comment=\"\" />\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"Python Script\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"ProjectColorInfo\">{\r\n  &quot;associatedIndex&quot;: 4\r\n}</component>\r\n  <component name=\"ProjectId\" id=\"38FPBu2HuieGGiTHouE7QUrUW7k\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"autoscrollFromSource\" value=\"true\" />\r\n    <option name=\"autoscrollToSource\" value=\"true\" />\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\"><![CDATA[{\r\n  \"keyToString\": {\r\n    \"ModuleVcsDetector.initialDetectionPerformed\": \"true\",\r\n    \"RunOnceActivity.ShowReadmeOnStart\": \"true\",\r\n    \"RunOnceActivity.git.unshallow\": \"true\",\r\n    \"RunOnceActivity.typescript.service.memoryLimit.init\": \"true\",\r\n    \"ai.playground.ignore.import.keys.banner.in.settings\": \"true\",\r\n    \"git-widget-placeholder\": \"Autenticazione\",\r\n    \"ignore.virus.scanning.warn.message\": \"true\",\r\n    \"nodejs_package_manager_path\": \"npm\",\r\n    \"vue.rearranger.settings.migration\": \"true\"\r\n  }\r\n}]]></component>\r\n  <component name=\"SharedIndexes\">\r\n    <attachedChunks>\r\n      <set>\r\n        <option value=\"bundled-js-predefined-d6986cc7102b-9b0f141eb926-JavaScript-PY-253.29346.142\" />\r\n        <option value=\"bundled-python-sdk-f2b7a9f6281b-6e1f45a539f7-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-253.29346.142\" />\r\n      </set>\r\n    </attachedChunks>\r\n  </component>\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"55397952-be6e-4a64-8a4f-522745ebe921\" name=\"Changes\" comment=\"\" />\r\n      <created>1768392214348</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1768392214348</updated>\r\n      <workItem from=\"1768392215557\" duration=\"762000\" />\r\n      <workItem from=\"1768403983401\" duration=\"1001000\" />\r\n    </task>\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n</project>
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/.idea/workspace.xml b/.idea/workspace.xml
---- a/.idea/workspace.xml	(revision 0616ccca72b5476477c7d1168a353cb351374c20)
-+++ b/.idea/workspace.xml	(date 1768405564889)
-@@ -56,7 +56,7 @@
-       <option name="presentableId" value="Default" />
-       <updated>1768392214348</updated>
-       <workItem from="1768392215557" duration="762000" />
--      <workItem from="1768403983401" duration="1001000" />
-+      <workItem from="1768403983401" duration="1338000" />
-     </task>
-     <servers />
-   </component>
Index: .idea/shelf/Uncommitted_changes_before_rebase__Changes_.xml
===================================================================
diff --git a/.idea/shelf/Uncommitted_changes_before_rebase__Changes_.xml b/.idea/shelf/Uncommitted_changes_before_rebase__Changes_.xml
deleted file mode 100644
--- a/.idea/shelf/Uncommitted_changes_before_rebase__Changes_.xml	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ /dev/null	(revision 489e417a4cc032d1174685030d2215fd52baf392)
@@ -1,4 +0,0 @@
-<changelist name="Uncommitted_changes_before_rebase_[Changes]" date="1768734260235" recycled="true" deleted="true">
-  <option name="PATH" value="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_rebase_[Changes]/shelved.patch" />
-  <option name="DESCRIPTION" value="Uncommitted changes before rebase [Changes]" />
-</changelist>
\ No newline at end of file
Index: .idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13_[Changes]/shelved.patch
===================================================================
diff --git a/.idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13_[Changes]/shelved.patch b/.idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13_[Changes]/shelved.patch
deleted file mode 100644
--- a/.idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13_[Changes]/shelved.patch	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ /dev/null	(revision 489e417a4cc032d1174685030d2215fd52baf392)
@@ -1,95 +0,0 @@
-Index: map4aid_project/models/pendingAccounts.py
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>from werkzeug.security import generate_password_hash, check_password_hash\r\n\r\nfrom config import db\r\nfrom datetime import datetime, timezone, timedelta\r\n\r\n\r\nclass PendingAccount(db.Model):\r\n    __tablename__ = \"pending_accounts\"\r\n\r\n    id = db.Column(db.Integer, primary_key=True)\r\n\r\n    # token di verifica\r\n    token = db.Column(db.String(64), unique=True, nullable=False, index=True)\r\n\r\n    # dati comuni Account\r\n    email = db.Column(db.String(120), nullable=False)\r\n    password_hash = db.Column(db.String(255), nullable=True)\r\n    tipo = db.Column(db.String(50), nullable=True)\r\n\r\n    # dati specifici del tipo (beneficiario, ente, ecc.)\r\n    extra_data = db.Column(db.JSON, nullable=True)\r\n    expires_at = db.Column(db.DateTime(timezone=True), nullable=False, default=lambda: datetime.now(timezone.utc) + timedelta(minutes=10))\r\n    created_at = db.Column(db.DateTime(timezone=True), default=lambda: datetime.now(timezone.utc), nullable=False)\r\n\r\n    # gestione password\r\n    def set_password(self, password):\r\n        self.password_hash = generate_password_hash(password)\r\n\r\n    def check_password(self, password):\r\n        return check_password_hash(self.password_hash, password)
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/map4aid_project/models/pendingAccounts.py b/map4aid_project/models/pendingAccounts.py
---- a/map4aid_project/models/pendingAccounts.py	(revision a4b0295139e7ebb620b9e11911f1f4a996e92239)
-+++ b/map4aid_project/models/pendingAccounts.py	(date 1769273398706)
-@@ -27,4 +27,4 @@
-         self.password_hash = generate_password_hash(password)
- 
-     def check_password(self, password):
--        return check_password_hash(self.password_hash, password)
-\ No newline at end of file
-+        return check_password_hash(self.password_has)
-\ No newline at end of file
-Index: map4aid_project/controllers/two_fa_contol.py
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>from datetime import datetime\r\nfrom flask import request, session, jsonify, Blueprint\r\n\r\nfrom config import db\r\nfrom controllers.routes import auth_bp\r\nfrom models.models import AccountBeneficiario, AccountEnteDonatore, AccountEnteErogatore\r\nfrom models.pendingAccounts import PendingAccount\r\n\r\n\r\n@auth_bp.route(\"/2FARegister\", methods=[\"POST\"])\r\ndef conferma_codice_registrazione():\r\n    email = session.get(\"pending_email\")\r\n    puser = PendingAccount.query.filter_by(email=email).first()\r\n    if not puser:\r\n        return jsonify({\"error\": \"Nessuna registrazionein corso\"}), 400\r\n\r\n    codice_inserito = request.form.get(\"codice\")\r\n    if codice_inserito != puser.token:\r\n        return jsonify({\"error\": \"Codice non valido\"}), 401\r\n\r\n    # Codice corretto → consenti registrazione\r\n    user = None\r\n    #----BENEFICIARIO-----\r\n    if puser.tipo == \"beneficiario\":\r\n        user = AccountBeneficiario(\r\n            email=email,\r\n            password_hash = puser.password_hash,\r\n            nome = puser.extra_data[\"nome\"],\r\n            cognome = puser.extra_data[\"cognome\"],\r\n            codice_fiscale = puser.extra_data[\"codice_fiscale\"]\r\n        )\r\n\r\n    # ----DONATORE-----\r\n    if puser.tipo == \"ente_donatore\":\r\n        user = AccountEnteDonatore(\r\n            email=email,\r\n            password_hash = puser.password_hash,\r\n            nome_attivita = puser.extra_data[\"nome_attivita\"],\r\n            partita_iva = puser.extra_data[\"partita_iva\"]\r\n        )\r\n\r\n    #--------ENTE EROGATORE--------\r\n    if puser.tipo == \"ente_erogatore\":\r\n        user = AccountEnteErogatore(\r\n            email=email,\r\n            password_hash = puser.password_hash,\r\n            iban = puser.extra_data[\"iban\"],\r\n            indirizzo_sede = puser.extra_data[\"indirizzo_sede\"],\r\n            tipologia_ente = puser.extra_data[\"tipologia_ente\"]\r\n        )\r\n    if(user == None):\r\n        return jsonify({\"error\": \"Nessuna registrazionein corso\"}), 400\r\n    db.session.add(user)\r\n    db.session.delete(puser)\r\n    db.session.commit()\r\n    session.pop(\"pending_email\")  # rimuovi email\r\n\r\n    return jsonify({\"message\": \"Codice valido, registrazione avvenuta\"}), 200\r\n\r\n\r\n@auth_bp.route(\"/2FALogin\", methods=[\"POST\"])\r\ndef conferma_codice_login():\r\n    email = session.get(\"pending_email\")\r\n    puser = PendingAccount.query.filter_by(email=email).first()\r\n    if not puser:\r\n        return jsonify({\"error\": \"Nessun login in corso\"}), 400\r\n\r\n    codice_inserito = request.form.get(\"codice\")\r\n    if codice_inserito != puser.token:\r\n        return jsonify({\"error\": \"Codice non valido\"}), 401\r\n\r\n    # Codice corretto → consenti login\r\n    session[\"logged_in\"] = True\r\n    session[\"user_email\"] = email\r\n    db.session.delete(puser)\r\n    session.pop(\"pendindg_email\")\r\n    return jsonify({\r\n        \"message\": \"Login effettuato con successo\",\r\n        \"email\": email\r\n    })\r\n\r\n\r\n
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/map4aid_project/controllers/two_fa_contol.py b/map4aid_project/controllers/two_fa_contol.py
---- a/map4aid_project/controllers/two_fa_contol.py	(revision a4b0295139e7ebb620b9e11911f1f4a996e92239)
-+++ b/map4aid_project/controllers/two_fa_contol.py	(date 1769272685957)
-@@ -73,7 +73,8 @@
-     session["logged_in"] = True
-     session["user_email"] = email
-     db.session.delete(puser)
--    session.pop("pendindg_email")
-+    db.session.commit()
-+    session.pop("pending_email")
-     return jsonify({
-         "message": "Login effettuato con successo",
-         "email": email
-Index: map4aid_project/controllers/login_control.py
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+>import secrets\r\nfrom datetime import datetime, timedelta\r\nfrom config import db\r\nfrom flask import request, session, jsonify, Blueprint\r\nfrom controllers.EmailControl import EmailControl\r\nfrom models.models import Account\r\nfrom models.pendingAccounts import PendingAccount\r\nfrom controllers.routes import auth_bp\r\n\r\n@auth_bp.route(\"/login\", methods=[\"POST\"])\r\ndef login():\r\n    email = request.form.get(\"email\")\r\n    password = request.form.get(\"password\")\r\n\r\n    if not email or not password:\r\n        return jsonify({\"error\": \"Email e password obbligatorie\"}), 400\r\n\r\n    user = Account.query.filter_by(email=email).first()\r\n\r\n    if not user:\r\n        return jsonify({\"error\": \"Credenziali non valide\"}), 401\r\n\r\n    if  not user.check_password(password):\r\n        return jsonify({\"error\": \"Credenziali non valide\"}), 401\r\n\r\n    # Genera codice OTP sicuro a 4 cifre\r\n    codice = secrets.randbelow(9000) + 1000  # tra 1000 e 9999\r\n    # Salva nella sessione\r\n    session[\"pending_email\"] = email\r\n    puser = PendingAccount(\r\n        email=email,\r\n        token=codice\r\n    )\r\n    db.session.add(puser)\r\n    db.session.commit()\r\n    email_control = EmailControl()\r\n    email_ok = email_control.invia_email_codice(email,codice)\r\n    if not email_ok:\r\n        return jsonify({\"error\": \"Email non inviata\"}), 401\r\n\r\n    return jsonify({\"message\": \"Email inviata\"}), 401\r\n\r\n\r\n@auth_bp.route(\"/logout\", methods=[\"POST\"])\r\ndef logout():\r\n    session.clear()\r\n    return jsonify({\"message\": \"Logout effettuato\"})\r\n\r\n@auth_bp.route(\"/recuperoPassword\", methods=[\"POST\"])\r\ndef recupero_password():\r\n    email = request.form.get(\"email\")\r\n    if not email:\r\n        return jsonify({\"error\": \"Email mancante\"}), 400\r\n\r\n    # Genera codice OTP sicuro a 4 cifre\r\n    codice = secrets.randbelow(9000) + 1000  # tra 1000 e 9999\r\n\r\n    # Salva nella sessione email\r\n    session[\"pending_email\"] = email\r\n    puser = PendingAccount(\r\n        email = email,\r\n        token = codice\r\n    )\r\n    db.session.add(puser)\r\n    db.session.commit()\r\n\r\n    # Invia email con il codice\r\n    email_control = EmailControl()\r\n    email_ok = email_control.invia_email_codice(email, codice)\r\n\r\n    if not email_ok:\r\n        return jsonify({\"message\": \"Email di recupero inviata\"}), 200\r\n\r\n    return jsonify({\"errore\": \"Email di recupero non inviata\"}), 200\r\n\r\n\r\n@auth_bp.route(\"/confermaRecupero\", methods=[\"POST\"])\r\ndef conferma_recupero():\r\n    email = session.get(\"pending_email\")\r\n    puser = PendingAccount.query.filter_by(email=email).first()\r\n    if not puser:\r\n        return jsonify({\"error\": \"Nessuna richiesta in corso\"}), 400\r\n\r\n    codice_inserito = request.form.get(\"codice\")\r\n    if codice_inserito != puser.token:\r\n        return jsonify({\"error\": \"Codice non valido\"}), 401\r\n\r\n    # Codice corretto → consenti cambio password\r\n    session[\"reset_verified\"] = email  # salva email verificata\r\n    session.pop(\"pending_email\")  # rimuovi codice\r\n\r\n    return jsonify({\"message\": \"Codice valido, puoi cambiare la password\"}), 200\r\n\r\n\r\n@auth_bp.route(\"/cambiaPassword\", methods=[\"POST\"])\r\ndef cambia_password():\r\n    email = session.get(\"reset_verified\")\r\n    if not email:\r\n        return jsonify({\"error\": \"Nessuna email verificata\"}), 400\r\n\r\n    nuova_password = request.form.get(\"nuova_password\")\r\n    if not nuova_password:\r\n        return jsonify({\"error\": \"Password mancante\"}), 400\r\n\r\n    user = Account.query.filter_by(email=email).first()\r\n    if not user:\r\n        return jsonify({\"error\": \"Utente non trovato\"}), 404\r\n\r\n    user.set_password(nuova_password)\r\n    db.session.commit()\r\n\r\n    session.pop(\"reset_verified\")  # pulizia sessione\r\n    return jsonify({\"message\": \"Password cambiata con successo\"}), 200
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/map4aid_project/controllers/login_control.py b/map4aid_project/controllers/login_control.py
---- a/map4aid_project/controllers/login_control.py	(revision a4b0295139e7ebb620b9e11911f1f4a996e92239)
-+++ b/map4aid_project/controllers/login_control.py	(date 1769273030118)
-@@ -38,7 +38,7 @@
-     if not email_ok:
-         return jsonify({"error": "Email non inviata"}), 401
- 
--    return jsonify({"message": "Email inviata"}), 401
-+    return jsonify({"message": "Email inviata"}), 200
- 
- 
- @auth_bp.route("/logout", methods=["POST"])
-Index: .idea/workspace.xml
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
-<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"55397952-be6e-4a64-8a4f-522745ebe921\" name=\"Changes\" comment=\"\">\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/app.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/app.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/EmailControl.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/EmailControl.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/SegnalazioneControl.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/SegnalazioneControl.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/login_control.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/login_control.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/two_fa_contol.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/two_fa_contol.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/instance/database.db\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/instance/database.db\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/tasks.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/tasks.py\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"Python Script\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"GitHubPullRequestSearchHistory\">{\r\n  &quot;lastFilter&quot;: {\r\n    &quot;state&quot;: &quot;OPEN&quot;,\r\n    &quot;assignee&quot;: &quot;girgio&quot;\r\n  }\r\n}</component>\r\n  <component name=\"GithubPullRequestsUISettings\">{\r\n  &quot;selectedUrlAndAccountId&quot;: {\r\n    &quot;url&quot;: &quot;https://github.com/cristian-carotenuto/map4aid.git&quot;,\r\n    &quot;accountId&quot;: &quot;ac26df4b-dbc5-47f8-91a4-7e31c3885a9b&quot;\r\n  }\r\n}</component>\r\n  <component name=\"ProjectColorInfo\">{\r\n  &quot;associatedIndex&quot;: 4\r\n}</component>\r\n  <component name=\"ProjectId\" id=\"38FPBu2HuieGGiTHouE7QUrUW7k\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"autoscrollFromSource\" value=\"true\" />\r\n    <option name=\"autoscrollToSource\" value=\"true\" />\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">{\r\n  &quot;keyToString&quot;: {\r\n    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,\r\n    &quot;Python.test.executor&quot;: &quot;Run&quot;,\r\n    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.typescript.service.memoryLimit.init&quot;: &quot;true&quot;,\r\n    &quot;ai.playground.ignore.import.keys.banner.in.settings&quot;: &quot;true&quot;,\r\n    &quot;git-widget-placeholder&quot;: &quot;controller&quot;,\r\n    &quot;ignore.virus.scanning.warn.message&quot;: &quot;true&quot;,\r\n    &quot;last_opened_file_path&quot;: &quot;C:/Users/Giovanni/Documents/GitHub/progetto-is/map4aid_project/controllers&quot;,\r\n    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,\r\n    &quot;settings.editor.selected.configurable&quot;: &quot;com.jetbrains.python.configuration.PyActiveSdkModuleConfigurable&quot;,\r\n    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;\r\n  }\r\n}</component>\r\n  <component name=\"RecentsManager\">\r\n    <key name=\"CopyFile.RECENT_KEYS\">\r\n      <recent name=\"C:\\Users\\Giovanni\\Documents\\GitHub\\progetto-is\\map4aid_project\\controllers\" />\r\n      <recent name=\"C:\\Users\\Giovanni\\Documents\\GitHub\\progetto-is\\map4aid_project\" />\r\n      <recent name=\"C:\\Users\\Giovanni\\Documents\\GitHub\\progetto-is\\map4aid_project\\models\" />\r\n    </key>\r\n  </component>\r\n  <component name=\"SharedIndexes\">\r\n    <attachedChunks>\r\n      <set>\r\n        <option value=\"bundled-js-predefined-d6986cc7102b-9b0f141eb926-JavaScript-PY-253.29346.142\" />\r\n        <option value=\"bundled-python-sdk-f2b7a9f6281b-6e1f45a539f7-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-253.29346.142\" />\r\n      </set>\r\n    </attachedChunks>\r\n  </component>\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"55397952-be6e-4a64-8a4f-522745ebe921\" name=\"Changes\" comment=\"\" />\r\n      <created>1768392214348</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1768392214348</updated>\r\n      <workItem from=\"1768392215557\" duration=\"762000\" />\r\n      <workItem from=\"1768403983401\" duration=\"1338000\" />\r\n      <workItem from=\"1769186513179\" duration=\"772000\" />\r\n      <workItem from=\"1769187309856\" duration=\"1206000\" />\r\n      <workItem from=\"1769188544451\" duration=\"745000\" />\r\n      <workItem from=\"1769189316896\" duration=\"11798000\" />\r\n      <workItem from=\"1769251543017\" duration=\"9057000\" />\r\n      <workItem from=\"1769262208012\" duration=\"1647000\" />\r\n      <workItem from=\"1769264557209\" duration=\"110000\" />\r\n      <workItem from=\"1769264717549\" duration=\"344000\" />\r\n      <workItem from=\"1769265864920\" duration=\"2887000\" />\r\n    </task>\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"com.intellij.coverage.CoverageDataManagerImpl\">\r\n    <SUITE FILE_PATH=\"coverage/progetto_is$test.coverage\" NAME=\"test Coverage Results\" MODIFIED=\"1769190857022\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"false\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$/map4aid_project/models\" />\r\n  </component>\r\n</project>
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/.idea/workspace.xml b/.idea/workspace.xml
---- a/.idea/workspace.xml	(revision a4b0295139e7ebb620b9e11911f1f4a996e92239)
-+++ b/.idea/workspace.xml	(date 1769273398986)
-@@ -3,13 +3,11 @@
-   <component name="ChangeListManager">
-     <list default="true" id="55397952-be6e-4a64-8a4f-522745ebe921" name="Changes" comment="">
-       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/map4aid_project/app.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/app.py" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/EmailControl.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/EmailControl.py" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/SegnalazioneControl.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/SegnalazioneControl.py" afterDir="false" />
-+      <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/donazione_monetariaControl.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/donazione_monetaria_control.py" afterDir="false" />
-       <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/login_control.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/login_control.py" afterDir="false" />
-       <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/two_fa_contol.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/two_fa_contol.py" afterDir="false" />
-       <change beforePath="$PROJECT_DIR$/map4aid_project/instance/database.db" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/instance/database.db" afterDir="false" />
--      <change beforePath="$PROJECT_DIR$/map4aid_project/tasks.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/tasks.py" afterDir="false" />
-+      <change beforePath="$PROJECT_DIR$/map4aid_project/models/pendingAccounts.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/models/pendingAccounts.py" afterDir="false" />
-     </list>
-     <option name="SHOW_DIALOG" value="false" />
-     <option name="HIGHLIGHT_CONFLICTS" value="true" />
-@@ -97,7 +95,7 @@
-       <workItem from="1769262208012" duration="1647000" />
-       <workItem from="1769264557209" duration="110000" />
-       <workItem from="1769264717549" duration="344000" />
--      <workItem from="1769265864920" duration="2887000" />
-+      <workItem from="1769265864920" duration="5828000" />
-     </task>
-     <servers />
-   </component>
-diff --git a/map4aid_project/controllers/donazione_monetariaControl.py b/map4aid_project/controllers/donazione_monetaria_control.py
-rename from map4aid_project/controllers/donazione_monetariaControl.py
-rename to map4aid_project/controllers/donazione_monetaria_control.py
Index: .idea/progetto-is.iml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<module version=\"4\">\r\n  <component name=\"PyDocumentationSettings\">\r\n    <option name=\"format\" value=\"PLAIN\" />\r\n    <option name=\"myDocStringFormat\" value=\"Plain\" />\r\n  </component>\r\n</module>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/progetto-is.iml b/.idea/progetto-is.iml
--- a/.idea/progetto-is.iml	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ b/.idea/progetto-is.iml	(date 1770132117117)
@@ -1,5 +1,12 @@
 <?xml version="1.0" encoding="UTF-8"?>
-<module version="4">
+<module type="PYTHON_MODULE" version="4">
+  <component name="NewModuleRootManager">
+    <content url="file://$MODULE_DIR$">
+      <sourceFolder url="file://$MODULE_DIR$/map4aid_project" isTestSource="false" />
+    </content>
+    <orderEntry type="jdk" jdkName="Python 3.14 (DeckBuilderCR)" jdkType="Python SDK" />
+    <orderEntry type="sourceFolder" forTests="false" />
+  </component>
   <component name="PyDocumentationSettings">
     <option name="format" value="PLAIN" />
     <option name="myDocStringFormat" value="Plain" />
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"55397952-be6e-4a64-8a4f-522745ebe921\" name=\"Changes\" comment=\"\">\r\n<<<<<<< HEAD\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/donazione_bene.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/donazione_bene.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/donazione_monetaria_control.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/donazione_monetaria_control.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/segnalazione_control.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/segnalazione_control.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/service_email/email_control_adapter.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/service_email/email_control_adapter.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/service_email/mail_sender.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/service_email/mail_sender.py\" afterDir=\"false\" />\r\n=======\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Merge_at_23_01_2026_19_43_[Changes]/shelved.patch\" beforeDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Merge_at_23_01_2026_19_43__Changes_.xml\" beforeDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/autenticazione_control.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/autenticazione_control.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/auth_facade.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/auth_facade.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/login_control.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/login_control.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/service_email/EmailControl.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/service_email/EmailControl.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/service_email/email_control_bridge.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/service_email/email_control_bridge.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/controllers/two_fa_contol.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/controllers/two_fa_contol.py\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/map4aid_project/models/models.py\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/map4aid_project/models/models.py\" afterDir=\"false\" />\r\n>>>>>>> controller\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"Python Script\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"FlaskConsoleOptions\" custom-start-script=\"import sys; print('Python %s on %s' % (sys.version, sys.platform)); sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;from flask.cli import ScriptInfo, NoAppException&#10;for module in [&quot;main.py&quot;, &quot;wsgi.py&quot;, &quot;app.py&quot;]:&#10;    try: locals().update(ScriptInfo(app_import_path=module, create_app=None).load_app().make_shell_context()); print(&quot;\\nFlask App: %s&quot; % app.import_name); break&#10;    except NoAppException: pass\">\r\n    <envs>\r\n      <env key=\"FLASK_APP\" value=\"app\" />\r\n    </envs>\r\n    <option name=\"myCustomStartScript\" value=\"import sys; print('Python %s on %s' % (sys.version, sys.platform)); sys.path.extend([WORKING_DIR_AND_PYTHON_PATHS])&#10;from flask.cli import ScriptInfo, NoAppException&#10;for module in [&quot;main.py&quot;, &quot;wsgi.py&quot;, &quot;app.py&quot;]:&#10;    try: locals().update(ScriptInfo(app_import_path=module, create_app=None).load_app().make_shell_context()); print(&quot;\\nFlask App: %s&quot; % app.import_name); break&#10;    except NoAppException: pass\" />\r\n    <option name=\"myEnvs\">\r\n      <map>\r\n        <entry key=\"FLASK_APP\" value=\"app\" />\r\n      </map>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"GitHubPullRequestSearchHistory\">{\r\n  &quot;lastFilter&quot;: {\r\n    &quot;state&quot;: &quot;OPEN&quot;,\r\n    &quot;assignee&quot;: &quot;girgio&quot;\r\n  }\r\n}</component>\r\n  <component name=\"GithubPullRequestsUISettings\">{\r\n  &quot;selectedUrlAndAccountId&quot;: {\r\n    &quot;url&quot;: &quot;https://github.com/cristian-carotenuto/map4aid.git&quot;,\r\n    &quot;accountId&quot;: &quot;ac26df4b-dbc5-47f8-91a4-7e31c3885a9b&quot;\r\n  }\r\n}</component>\r\n  <component name=\"ProjectColorInfo\">{\r\n  &quot;associatedIndex&quot;: 4\r\n}</component>\r\n  <component name=\"ProjectId\" id=\"38FPBu2HuieGGiTHouE7QUrUW7k\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"autoscrollFromSource\" value=\"true\" />\r\n    <option name=\"autoscrollToSource\" value=\"true\" />\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\">{\r\n  &quot;keyToString&quot;: {\r\n    &quot;ModuleVcsDetector.initialDetectionPerformed&quot;: &quot;true&quot;,\r\n    &quot;Python.test.executor&quot;: &quot;Run&quot;,\r\n    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.TerminalTabsStorage.copyFrom.TerminalArrangementManager.252&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,\r\n    &quot;RunOnceActivity.typescript.service.memoryLimit.init&quot;: &quot;true&quot;,\r\n    &quot;ai.playground.ignore.import.keys.banner.in.settings&quot;: &quot;true&quot;,\r\n    &quot;git-widget-placeholder&quot;: &quot;controller&quot;,\r\n    &quot;ignore.virus.scanning.warn.message&quot;: &quot;true&quot;,\r\n    &quot;last_opened_file_path&quot;: &quot;C:/Users/Giovanni/Documents/GitHub/progetto-is/map4aid_project/controllers&quot;,\r\n    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,\r\n    &quot;settings.editor.selected.configurable&quot;: &quot;preferences.keymap&quot;,\r\n    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;\r\n  }\r\n}</component>\r\n  <component name=\"RecentsManager\">\r\n    <key name=\"CopyFile.RECENT_KEYS\">\r\n      <recent name=\"C:\\Users\\Giovanni\\Documents\\GitHub\\progetto-is\\map4aid_project\\controllers\" />\r\n      <recent name=\"C:\\Users\\Giovanni\\Documents\\GitHub\\progetto-is\\map4aid_project\" />\r\n      <recent name=\"C:\\Users\\Giovanni\\Documents\\GitHub\\progetto-is\\map4aid_project\\models\" />\r\n    </key>\r\n    <key name=\"MoveFile.RECENT_KEYS\">\r\n<<<<<<< HEAD\r\n=======\r\n      <recent name=\"C:\\Users\\Giovanni\\Documents\\GitHub\\progetto-is\\map4aid_project\\controllers\" />\r\n      <recent name=\"C:\\Users\\Giovanni\\Documents\\GitHub\\progetto-is\\map4aid_project\\controllers\\auth_service\" />\r\n>>>>>>> controller\r\n      <recent name=\"C:\\Users\\Giovanni\\Documents\\GitHub\\progetto-is\\map4aid_project\\controllers\\service_email\" />\r\n      <recent name=\"C:\\Users\\Giovanni\\Documents\\GitHub\\progetto-is\\map4aid_project\" />\r\n    </key>\r\n  </component>\r\n  <component name=\"SharedIndexes\">\r\n    <attachedChunks>\r\n      <set>\r\n        <option value=\"bundled-js-predefined-d6986cc7102b-9b0f141eb926-JavaScript-PY-253.29346.142\" />\r\n        <option value=\"bundled-python-sdk-f2b7a9f6281b-6e1f45a539f7-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-253.29346.142\" />\r\n      </set>\r\n    </attachedChunks>\r\n  </component>\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"55397952-be6e-4a64-8a4f-522745ebe921\" name=\"Changes\" comment=\"\" />\r\n      <created>1768392214348</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1768392214348</updated>\r\n      <workItem from=\"1768392215557\" duration=\"762000\" />\r\n      <workItem from=\"1768403983401\" duration=\"1338000\" />\r\n      <workItem from=\"1769186513179\" duration=\"772000\" />\r\n      <workItem from=\"1769187309856\" duration=\"1206000\" />\r\n      <workItem from=\"1769188544451\" duration=\"745000\" />\r\n      <workItem from=\"1769189316896\" duration=\"11798000\" />\r\n      <workItem from=\"1769251543017\" duration=\"9057000\" />\r\n      <workItem from=\"1769262208012\" duration=\"1647000\" />\r\n      <workItem from=\"1769264557209\" duration=\"110000\" />\r\n      <workItem from=\"1769264717549\" duration=\"344000\" />\r\n      <workItem from=\"1769265864920\" duration=\"5828000\" />\r\n      <workItem from=\"1769298198366\" duration=\"1578000\" />\r\n      <workItem from=\"1769332953455\" duration=\"54000\" />\r\n      <workItem from=\"1769342328244\" duration=\"3443000\" />\r\n      <workItem from=\"1769351621565\" duration=\"5072000\" />\r\n      <workItem from=\"1769385432852\" duration=\"4086000\" />\r\n      <workItem from=\"1769426941686\" duration=\"2079000\" />\r\n      <workItem from=\"1769447523955\" duration=\"13740000\" />\r\n      <workItem from=\"1769511089401\" duration=\"657000\" />\r\n      <workItem from=\"1769512141790\" duration=\"5121000\" />\r\n      <workItem from=\"1769541614008\" duration=\"983000\" />\r\n<<<<<<< HEAD\r\n      <workItem from=\"1769598313622\" duration=\"6605000\" />\r\n=======\r\n      <workItem from=\"1769598313622\" duration=\"9772000\" />\r\n      <workItem from=\"1769679702917\" duration=\"8782000\" />\r\n      <workItem from=\"1769778445605\" duration=\"4769000\" />\r\n      <workItem from=\"1769858239139\" duration=\"5599000\" />\r\n>>>>>>> controller\r\n    </task>\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"com.intellij.coverage.CoverageDataManagerImpl\">\r\n    <SUITE FILE_PATH=\"coverage/progetto_is$test.coverage\" NAME=\"test Coverage Results\" MODIFIED=\"1769515357915\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"false\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$/map4aid_project\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ b/.idea/workspace.xml	(date 1770141138045)
@@ -2,25 +2,22 @@
 <project version="4">
   <component name="ChangeListManager">
     <list default="true" id="55397952-be6e-4a64-8a4f-522745ebe921" name="Changes" comment="">
-<<<<<<< HEAD
+      <change beforePath="$PROJECT_DIR$/.idea/misc.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/misc.xml" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/progetto-is.iml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/progetto-is.iml" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13_[Changes]/database.db" beforeDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13_[Changes]/shelved.patch" beforeDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Merge_at_25_01_2026_01_13__Changes_.xml" beforeDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_rebase_[Changes]/shelved.patch" beforeDir="false" />
+      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_rebase__Changes_.xml" beforeDir="false" />
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/donazione_bene.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/donazione_bene.py" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/donazione_monetaria_control.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/donazione_monetaria_control.py" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/login_control.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/login_control.py" afterDir="false" />
+      <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/prenotazione_conrol.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/prenotazione_conrol.py" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/segnalazione_control.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/segnalazione_control.py" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/service_email/email_control_adapter.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/service_email/email_control_adapter.py" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/service_email/mail_sender.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/service_email/mail_sender.py" afterDir="false" />
-=======
-      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Merge_at_23_01_2026_19_43_[Changes]/shelved.patch" beforeDir="false" />
-      <change beforePath="$PROJECT_DIR$/.idea/shelf/Uncommitted_changes_before_Merge_at_23_01_2026_19_43__Changes_.xml" beforeDir="false" />
-      <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/autenticazione_control.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/autenticazione_control.py" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/auth_facade.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/auth_facade.py" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/login_control.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/login_control.py" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/service_email/EmailControl.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/service_email/EmailControl.py" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/service_email/email_control_bridge.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/service_email/email_control_bridge.py" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/map4aid_project/controllers/two_fa_contol.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/controllers/two_fa_contol.py" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/map4aid_project/models/models.py" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/models/models.py" afterDir="false" />
->>>>>>> controller
+      <change beforePath="$PROJECT_DIR$/map4aid_project/instance/database.db" beforeDir="false" afterPath="$PROJECT_DIR$/map4aid_project/instance/database.db" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
@@ -94,11 +91,8 @@
       <recent name="C:\Users\Giovanni\Documents\GitHub\progetto-is\map4aid_project\models" />
     </key>
     <key name="MoveFile.RECENT_KEYS">
-<<<<<<< HEAD
-=======
       <recent name="C:\Users\Giovanni\Documents\GitHub\progetto-is\map4aid_project\controllers" />
       <recent name="C:\Users\Giovanni\Documents\GitHub\progetto-is\map4aid_project\controllers\auth_service" />
->>>>>>> controller
       <recent name="C:\Users\Giovanni\Documents\GitHub\progetto-is\map4aid_project\controllers\service_email" />
       <recent name="C:\Users\Giovanni\Documents\GitHub\progetto-is\map4aid_project" />
     </key>
@@ -106,7 +100,6 @@
   <component name="SharedIndexes">
     <attachedChunks>
       <set>
-        <option value="bundled-js-predefined-d6986cc7102b-9b0f141eb926-JavaScript-PY-253.29346.142" />
         <option value="bundled-python-sdk-f2b7a9f6281b-6e1f45a539f7-com.jetbrains.pycharm.pro.sharedIndexes.bundled-PY-253.29346.142" />
       </set>
     </attachedChunks>
@@ -139,14 +132,10 @@
       <workItem from="1769511089401" duration="657000" />
       <workItem from="1769512141790" duration="5121000" />
       <workItem from="1769541614008" duration="983000" />
-<<<<<<< HEAD
-      <workItem from="1769598313622" duration="6605000" />
-=======
       <workItem from="1769598313622" duration="9772000" />
       <workItem from="1769679702917" duration="8782000" />
       <workItem from="1769778445605" duration="4769000" />
       <workItem from="1769858239139" duration="5599000" />
->>>>>>> controller
     </task>
     <servers />
   </component>
Index: .idea/misc.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"Black\">\r\n    <option name=\"sdkName\" value=\"Python 3.14 (DeckBuilderCR)\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/misc.xml b/.idea/misc.xml
--- a/.idea/misc.xml	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ b/.idea/misc.xml	(date 1770132079311)
@@ -3,4 +3,5 @@
   <component name="Black">
     <option name="sdkName" value="Python 3.14 (DeckBuilderCR)" />
   </component>
+  <component name="ProjectRootManager" version="2" project-jdk-name="Python 3.14 (DeckBuilderCR)" project-jdk-type="Python SDK" />
 </project>
\ No newline at end of file
