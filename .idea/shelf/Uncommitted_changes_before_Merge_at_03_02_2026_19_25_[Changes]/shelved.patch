Index: map4aid_project/controllers/prenotazione_conrol.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>from datetime import timezone, datetime\r\nfrom flask import request, session\r\nfrom controllers.routes import auth_bp\r\nfrom controllers.service_email.email_control_bridge import EmailControlAdapter\r\nfrom models import AccountEnteErogatore\r\nfrom controllers.permessi import require_roles\r\nfrom config import db\r\nfrom models.models import AccountDonatore, DonazioneMonetaria\r\n\r\n\r\n@auth_bp.route(\"/prenotazione\", methods=[\"POST\"])\r\n@require_roles(\"beneficiario\")\r\ndef prenotazione():
===================================================================
diff --git a/map4aid_project/controllers/prenotazione_conrol.py b/map4aid_project/controllers/prenotazione_conrol.py
--- a/map4aid_project/controllers/prenotazione_conrol.py	(revision 489e417a4cc032d1174685030d2215fd52baf392)
+++ b/map4aid_project/controllers/prenotazione_conrol.py	(date 1770143108161)
@@ -1,13 +1,46 @@
 from datetime import timezone, datetime
 from flask import request, session
 from controllers.routes import auth_bp
-from controllers.service_email.email_control_bridge import EmailControlAdapter
-from models import AccountEnteErogatore
+from controllers.service_email.email_control_bridge import EmailControlBridge
+from models import AccountEnteErogatore, AccountBeneficiario
 from controllers.permessi import require_roles
 from config import db
-from models.models import AccountDonatore, DonazioneMonetaria
+from models.models import AccountDonatore, DonazioneMonetaria, BeneAlimentare,Bene,PaccoAlimentare
 
 
 @auth_bp.route("/prenotazione", methods=["POST"])
 @require_roles("beneficiario")
-def prenotazione():
\ No newline at end of file
+def prenotazione():
+    id_punto_bisogno = request.form.get("id_punto_bisogno")
+
+    is_pacco = request.form.get("is_pacco")
+    id_bene = request.form.get("id_bene")
+    bene = Bene.query.filter_by(id=id_bene).first()
+    user_email = session['user_email']
+    user = AccountBeneficiario.query.filter_by(email=user_email).first()
+    mail_sender = EmailControlBridge()
+
+    #Check per le prenotazione
+    if is_pacco == "True":
+        if is_craftable(id_punto_bisogno):
+            pane = BeneAlimentare.query.filter_by(id_punto_bisogno=id_punto_bisogno,sottocategoria_id="pane").first()
+            pasta = BeneAlimentare.query.filter_by(id_punto_bisogno=id_punto_bisogno,sottocategoria_id="pasta").first()
+            carne = BeneAlimentare.query.filter_by(id_punto_bisogno=id_punto_bisogno,sottocategoria_id="carne").first()
+            acqua = BeneAlimentare.query.filter_by(id_punto_bisogno=id_punto_bisogno,sottocategoria_id="acqua").first()
+            pesce = BeneAlimentare.query.filter_by(id_punto_bisogno=id_punto_bisogno,sottocategoria_id="pesce").first()
+            verdura = BeneAlimentare.query.filter_by(id_punto_bisogno=id_punto_bisogno,sottocategoria_id="verdura").first()
+            pacco = PaccoAlimetare(pasta,pane,acqua,carne,pesce,verdura)
+            pane.quantita -= 1
+            pane.save()
+            pasta.quantita -= 1
+            pasta.save()
+            carne.quantita -= 1
+            carne.save()
+            acqua.quantita -= 1
+            acqua.save()
+            pesce.quantita -= 1
+            pesce.save()
+            db.session.commit()
+            mail_sender.send_prenotazione_ente()
+
+
